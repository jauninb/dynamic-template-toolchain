version: 2
template:
  name: Build your own toolchain
  description: dynamic-template-prototype
  required:
    - githubconsolidated01
    - githubconsolidated02
  $configuration:
    ENABLE_EXTENSIONS: true
    ENABLE_IF_ELSE: true
    EXPRESSION_MAXLENGTH: 1000
toolchain:
  name: "a-dynamic-templated-toolchain-{{timestamp}}"
services:
  pipeline00:
    parameters:
      label: tekton
      type: tekton
      name: tekton
      ui_pipeline: false
      configuration:
        env:
          GIT_COMMIT_EVENT_LISTENER_NAME: >
            if ( $env.source_provider === 'githubconsolidated' ) {
              'github-commit';
            } else if ( $env.source_provider === 'hostedgit' ) {
              'grit-or-gitlab-commit';
            } else if ( $env.source_provider === 'gitlab' ) {
              'grit-or-gitlab-commit';
            } else if ( $env.source_provider === 'bitbucketgit' ) {
              'bitbucket-commit';
            } else if ( $env.source_provider === 'github_integrated' ) {
              'github-commit';
            } else {
              'github-commit';
            }
          githubconsolidated02: githubconsolidated02
          repository_url: "{{services.githubconsolidated01.parameters.repo_url}}"
          repository_url_if: >
            if ( $env.services.githubconsolidated01.parameters.type === "link" ) {
              $env.services.githubconsolidated01.parameters.repo_url;
            } else {
              if ( $env.services.githubconsolidated01.parameters.type === "new" ) {
              } else {
                if ( $env.services.githubconsolidated01.parameters.type === "fork" ) {
                  "fork";
                } else {
                  if ( $env.services.githubconsolidated01.parameters.type === "clone" ) {
                    "clone";
                  } else {
                    "(default)https://github.com/open-toolchain/hello-containers.git";
                  }
                }
              }
            }
        content:
          $text: pipeline_pipeline00.yml
      services:
        - githubconsolidated01
        - githubconsolidated02
    service_id: pipeline
  githubconsolidated01:
    parameters:
      type: link
      repo_url: https://github.com/open-toolchain/hello-containers.git
      has_issues: false
      enable_traceability: false
    service_id: >
      $env.source_provider ? $env.source_provider : 'githubconsolidated'
  githubconsolidated02:
    parameters:
      type: link
      repo_url: https://github.com/open-toolchain/tekton-catalog.git
      has_issues: false
      enable_traceability: false
    service_id: githubconsolidated
